<div class="col-sm-12">
    <div id="exampleModalLive" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLiveLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLiveLabel">INSERT FORM</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="card-body">
                        <form id="insertBookForm" enctype="multipart/form-data">
                            <div class="form-group row">
                                <label for="title" class="col-sm-2 col-form-label">Title</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control w-100" name="title" id="title" placeholder="Enter Title">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="author" class="col-sm-2 col-form-label">Author</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control w-100" name="author" id="author" placeholder="Enter Author">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">Category</label>
                                <div class="col-md-4">
                                    <select class="form-control w-100" name="categoryId">
                                        <% categories.forEach(category => { %>
                                            <option value="<%= category._id %>"><%= category.name %></option>
                                        <% }); %>
                                    </select>
                                </div>
                                <label class="col-sm-2 col-form-label">Publisher</label>
                                <div class="col-md-4">
                                    <select class="form-control w-100" name="publisherId">
                                        <% publishers.forEach(publisher => { %>
                                            <option value="<%= publisher._id %>"><%= publisher.name %></option>
                                        <% }); %>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="description" class="col-sm-2 col-form-label">Description</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control w-100" name="description" id="description" rows="3"></textarea>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="price" class="col-sm-2 col-form-label">Price</label>
                                <div class="col-sm-5">
                                    <input type="number" class="form-control w-100" name="price" id="price" placeholder="Enter Price">
                                </div>
                                <label for="stock" class="col-sm-1 col-form-label">Stock</label>
                                <div class="col-sm-4">
                                    <input type="number" class="form-control w-100" name="stock" id="stock" placeholder="Enter Stock">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="coverImage" class="col-sm-2 col-form-label">Cover Image</label>
                                <div class="col-sm-10">
                                    <input type="file" class="form-control w-100" name="coverImage" id="coverImage">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Add</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
document.querySelector("#insertBookForm").addEventListener("submit", function(event) {
    event.preventDefault();
    
    const formData = new FormData(this);

    // ✅ Kiểm tra dữ liệu form trước khi gửi
    for (let [key, value] of formData.entries()) {
        console.log(`${key}: ${value}`);
    }

    fetch('/admin/books/', { 
        method: "POST",
        body: formData 
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("Thêm sách thành công!");
            location.reload(); // ✅ Load lại danh sách sau khi thêm thành công
        } else {
            alert("Lỗi khi thêm sách!");
        }
    })
    .catch(error => {
        alert("Lỗi khi thêm sách!");
        console.error(error);
    });
});
</script>

