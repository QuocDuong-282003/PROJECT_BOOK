<%- include('./client/layouts/style') %>
<%- include('./client/layouts/header') %>
<div class="all-title-box">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h2>Wishlist</h2>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">Shop</a></li>
                    <li class="breadcrumb-item active">Wishlist</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- End All Title Box -->

<!-- Start Wishlist  -->
<div class="wishlist-box-main">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="table-main table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>NO.</th>
                                <th>Order ID</th>
                                <th>Data Create </th>
                                <th>Status</th>
                                <th>Total Price</th>
                                <th>View</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% let NO = 1; %> 
                            <% orders.forEach(order => { %>
                                <tr>
                                    <td class="thumbnail-img">
                                        <%=NO++ %>
                                    </td>
                                    <td class="name-pr">
                                        <%= order.orderId %>
                                    </td>
                                    <% function formatDate(date) { %>
                                        <%= new Date(date).toLocaleString("en-GB", {
                                            day: "2-digit",
                                            month: "2-digit",
                                            year: "numeric",
                                            hour: "2-digit",
                                            minute: "2-digit",
                                            second: "2-digit",
                                            hour12: false
                                        }) %>
                                      <% } %>
                                      
                                    <td class="price-pr">
                                        <p><%= formatDate(order.orderDate )%></p>
                                    </td>
                                    <% 
                                        let status ="";
                                        if(order.status==0){
                                            status ="Pending";
                                        }else if(order.status==1){
                                            status ="Success";
                                        }else{
                                            status ="Cancelled"
                                        }
                                    %>
                                    <td class="quantity-box"><%= status %></td>
                                    <td class="add-pr">
                                        <%= order.totalAmount %> VNĐ
                                    </td>
                                    <td class="">
                                        <button type="button" class="btn btn-primary btn-sm view-order-btn" data-toggle="modal" data-target="#modelId" data-items='<%- JSON.stringify(order.items) %>' data-orderid="<%= order.orderId %>">
                                            View
                                        </button>
                                    </td>
                                </tr>
                            <%}) %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="modelId" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Order Detail - <span id="modal-order-id"></span></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="odr-box">
            <div class="title-left">
              <h3>Order List</h3>
            </div>
            <div class="rounded p-2 bg-light" id="modal-items-container">
              <!-- Nội dung item sẽ được thêm bằng JS -->
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  
<%- include('./client/layouts/footer') %>
<%- include('./client/layouts/script') %>

<script>
    document.addEventListener("DOMContentLoaded", function () {
      const modalItemsContainer = document.getElementById("modal-items-container");
      const modalOrderIdSpan = document.getElementById("modal-order-id");
  
      document.querySelectorAll(".view-order-btn").forEach((btn) => {
        btn.addEventListener("click", function () {
          const items = JSON.parse(this.getAttribute("data-items"));
          const orderId = this.getAttribute("data-orderid");
  
          modalOrderIdSpan.textContent = orderId;
  
          if (items.length === 0) {
            modalItemsContainer.innerHTML = "<p>Không có sản phẩm nào.</p>";
            return;
          }
  
          // Xóa nội dung cũ
          modalItemsContainer.innerHTML = "";
  
          items.forEach((item) => {
            const itemHTML = `
              <div class="media mb-2 border-bottom">
                <div class="media-body">
                  <a href="#">${item.bookId.title}</a>
                  <div class="small text-muted">
                    Price: ${item.price} VNĐ
                    <span class="mx-2">|</span> Qty: ${item.quantity}
                    <span class="mx-2">|</span> Subtotal: ${(item.price * item.quantity)} VNĐ
                  </div>
                </div>
              </div>
            `;
            modalItemsContainer.innerHTML += itemHTML;
          });
        });
      });
    });
  </script>
  